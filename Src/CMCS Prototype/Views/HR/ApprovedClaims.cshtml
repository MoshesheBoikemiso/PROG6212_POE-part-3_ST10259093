@model List<CMCS_Prototype.Models.Claim>
@{
    ViewData["Title"] = "Approved Claims";
}

<div class="container">
    <h2>Approved Claims Ready for Processing</h2>

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }

    @if (Model != null && Model.Any())
    {
        <div class="table-responsive"> 
            <table class="table table-striped table-bordered">
                <thead class="table-dark">
                    <tr>
                        <th>Claim ID</th>
                        <th>Lecturer</th>
                        <th>Claim Month</th>
                        <th>Hours</th>
                        <th>Rate</th>
                        <th>Total Amount</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var claim in Model)
                    {
                        <tr>
                            <td>@claim.ClaimID</td>
                            <td>@claim.User?.FirstName @claim.User?.LastName</td>
                            <td>@claim.ClaimMonth.ToString("MMMM yyyy")</td>
                            <td>@claim.TotalHours.ToString("N1")</td>
                            <td>R @claim.HourlyRate.ToString("N2")</td>
                            <td><strong>R @claim.TotalAmount.ToString("N2")</strong></td>
                            <td>
                                <span class="badge @(claim.Status == "Fully Approved" ? "bg-success" : "bg-info")">
                                    @claim.Status
                                </span>
                            </td>
                            <td>
                                <div class="btn-group btn-group-sm">
                                    <a href="@Url.Action("GenerateInvoice", "HR", new { claimId = claim.ClaimID })"
                                       class="btn btn-success" title="Generate Invoice">
                                        🧾 Invoice
                                    </a>
                                    @if (claim.Status == "Fully Approved")
                                    {
                                        <a href="@Url.Action("ProcessBatchPayments", "HR")"
                                           class="btn btn-primary" title="Include in Batch">
                                            💳 Batch
                                        </a>
                                    }
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <div class="mt-3">
            <a href="@Url.Action("ProcessBatchPayments", "HR")" class="btn btn-primary">
                🚀 Process All Approved Claims
            </a>
        </div>
    }
    else
    {
        <div class="alert alert-info">
            <p>No approved claims ready for processing.</p>
            <p>Claims need to be "Fully Approved" by both Coordinator and Manager before they appear here.</p>
        </div>
    }

    <div class="mt-3">
        <a href="@Url.Action("HRDashboard", "HR")" class="btn btn-secondary">Back to Dashboard</a>
    </div>
</div>